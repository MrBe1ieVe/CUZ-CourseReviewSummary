[toc]

## 题型分布

1. 单选 $1' \times 15$
2. 填空 $1' \times 20$
3. 判断 $2' \times 5$
4. 名词 $5' \times 5$
5. 简答 $5' \times 6$

## Kali
### 基本介绍

- 是一个基于 Linux Kernel 的操作系统
- 从 BackTrack 发展而来，最后一个版本是 BackTrack 5 R3
- 设计目标是用于数字取证

### 五个特征

- Kali 是一个基于 Debian 的 Linux 发行版
- Kali 预装了大量安全工具
- Kali 是永久免费的
- Kali 支持大量的无线设备
- Kali 系统自身是安全的

### 三个主要功能

- 数字取证：数字取证主要是**针对电子证据**进行**识别、收集、保存和分析**，用来**发现**网络和系统的各种**入侵行为**，为进一步的**安全处理**提供依据。数字取证处理的**对象是电子证据**，是指以存储的**电子化信息资料**来**证明案件真实情况**的电子物品或电子记录
- 安全审计：专业审计人员**根据**有关的**法律法规**、财产所有者的委托和管理当局的**授权**，对计算机网络环境下的有关活动或行为进行**系统的**、独立的**检查验证**，并**做出**相应**评价**
- 渗透测试：通**过模拟恶意黑客的攻击**方法，来**评估**计算机网络**系统安全**的一种评估方法
    - 黑盒测试
    - 白盒测试
    - 灰盒测试

### 安装方式

- 硬盘
- U 盘
- 树莓派
- 虚拟机

### 默认账密

- root
- toor

### 网络设置

- 桥接。处于同一网段
- NAT。通过虚拟网卡 vmnat8 构成一个虚拟网络
- 仅主机。通过虚拟网卡 vmnat1 构成一个虚拟网络，且没开启 NAT

### 服务设置

Windows 运行 `services.msc` 打开服务窗口，启动 VMware 相关服务

### 启动 ssh 和 web 服务

```bash
$ service ssh start
$ service apache2 start
```

## 靶机系统
### 靶机

在使用 Kali 系统进行安全渗透测试时，需要有一个攻击或渗透测试的对象或目标，这就是靶机

### Metasploitable

Metasploitable 是一个专为 Metasploit 渗透工具打造的靶机环境，是一个刻意制作出来包含漏洞的基于 Ubuntu 的 Linux 虚拟机系统

### DVWA

DVWA（Damn Vulnerable Web Application）是一个针对 Web 应用的 Web 漏洞实验平台，是一个用来进行安全脆弱性鉴定的 PHP/MySQL Web 应用

### OWASP WebGoat

OWASP 是一个组织，全称是 “Open Web Application Security Project”，翻译为中文就是“开放式 Web 应用程序安全项目”。WebGoat 是 OWASP 众多安全产品中的一个，主要用于 Web 漏洞实验， 同 DVWA 一样是一个 Web 漏洞实验平台

## 信息收集
### 信息收集四个目标

- 硬件设备
    - 系统架构信息、网络设备信息、网络连接设备
    - CPU、内存、磁盘
- 操作系统
- 应用软件
- 网络环境

### 信息收集四个方面

- 硬件设备
- 操作系统
- 应用软件
- 网络环境

### 信息收集的分类

- 被动信息收集：不会与目标服务器做直接的交互，通过搜索引擎、社交媒体等方式对目标外围的信息进行收集
- 主动信息收集：会与目标系统有直接的接触和交互，从目标系统直接获取需要的情报信息

### 查看网卡

- ipconfig
- ifconfig

- `lo` 为环回接口
- `eth0` 为当前工作的网卡接口
- `wlan0` 为无线网卡接口

### whois

- 查询域名的 IP 以及所有者等信息，如域名注册商、DNS 服务器地址、联系电话、邮箱、姓名、地址等
- Whois 查询服务的端口一般是 TCP 协议的 43 号端口

### 旁站查询

旁站就是和目标网站处于同一服务器的站点

有些情况下，在对一个网站进行渗透时，发现网站安全性较高，久攻不下，那么我们就可以试着从其旁站入手，等拿到一个旁站的 Webshell 后，看是否有跨目录的权限，如果有，直接对目标网站进行跨权限渗透；如果没有，继续提升权限拿到更高权限之后再对目标网站进行渗透

### C 段网站查询

同一个网站中设备的 IP 地址分配往往是连续的、相近的，因为它们很可能在一个内网中，一旦获取了其中某台主机的控制权，相当于打入了网络内部，这样就可以对目标网站发起内网渗透

### Nmap

- 信息收集
- 漏洞扫描

`-p1-1023` 指定端口扫描范围

### 指纹探测

指纹探测就是对目标主机的系统版本、服务版本以及目标站点所用的内容管理系统（Content Management System，CMS）版本进行探测，为漏洞发现做铺垫

- 收集目标主机的系统及其版本信息 `-O`
- 收集目标主机开启的服务端口及其版本信息 `-sV`
- 收集目标站点的 CMS 信息

### 漏洞扫描

- Nmap
    - 脚本引擎 `.nse`
    - `--script=`
- Nessus
    - 安装在 `/opt/nessus`
    - `/etc/init.d/nessus start`，访问 `https://localhost:8834/`
    - 扫描本地漏洞
        - 指定策略
        - 建立扫描任务
        - 执行扫描任务
- OpenVAS
    - C/S 架构
    - 是 Nessus 的分支，但完全免费

## Metaspolit

- Armitage
- MSF Console

### 六种模块

- 辅助模块（Auxiliary）
    - 为渗透测试的信息搜集提供支持
- 攻击载荷模块（Payloads）
    - 为渗透攻击打开在目标系统上的控制会话连接
- 空指令模块（Nops）
    - 是一些对程序运行状态不会造成任何实质性影响的空操作或无关操 作的指令
- 编码器模块（Encoders）
    - 检查指令序列的正确性和完整 性，避免“非法字符”(坏字符)影响攻击载荷对漏洞的植入
- 渗透攻击模块（Exploits）
    - 利用发现的安 全漏洞或配置弱点对远程目标系统进行攻击，以植入和运行攻击载荷，从而获 取对远程目标主机系统的访问控制权
- 后渗透攻击模块（Post）
    - 在渗透攻击取得目标系统的远程控制权后，在受控系统中进行各种后 渗透攻击动作

### 三种攻击载荷

- 独立攻击载荷（Singles）
- 传输器载荷（Stager）
- 传输体载荷（Stage）

### Meterpreter

- 是一种攻击载荷，更具体一点是一个传输体载荷（Stage）
- 具有平台通用性，适用于各种类型的操作系统平台
- 具有灵活且加密的通信协议，本身的安全性得到保障
- 易于扩展，可以加载各种功能模块和插件
- 纯内存工作模式，执行漏洞渗透攻击的时候会直接装载 Meterpreter 的动态链接库到目标进程的空间中，这样使得 Meterpreter 启动隐蔽，很难被杀毒软件检测到

### Meterpreter 步骤

1. 生成后门程序文件 `msfvenom`
2. 将后门程序上传到靶机并添加可执行权限
3. 启动 MSFConsole 并使用 `exploit/multi/handler` 模块开始监听
4. 在靶机上运行后门程序
5. 获取反向连接 shell 并运行 Meterpreter
6. 用 Meterpreter 进行后渗透攻击

不同的攻击载荷 `linux/x86/meterpreter/reverse_tcp` 模块

## 密码攻击
### 密码字典

在进行密码的枚举破解时，用哪些字符组合去尝试，以及尝试的顺序如何，显然不能在破解的同时随机地决定，需要有一个明确的答案。这就是密码字典，在密码字典中按照由短到长、由简单到复杂、由常用到不常用的顺序保存的密码组合，密码破解工具将会按照密码字典中存储的密码顺序去逐一尝试，直到密码匹配或者密码字典中的密码耗尽为止

### 密码字典生成工具

- crunch
- rtgen：可生成彩虹表

### 密码破解工具

- Hydra
- Medusa：更稳定，但模块较少，不支持 RDP

### 彩虹表

彩虹表是一个散列值（也叫哈希值、报文摘要）的集合，为了破解密码的散列值(密码往往以散列值的形式存储)，人们预先计算各种字母组合的散列值，并将其存储在彩虹表中

彩虹表存储的不是密码本身，而是密码的散列值

## 权限提升
### Windows 访问令牌

当用户登录时，系统创建一个访问令牌，里面包含登录进程返回的 **SID** 和由本地安全策略分配给用户和用户的安全组的 **特权列表**。以该用户身份运行的所有进程都拥有该令牌的一个拷贝

- 主令牌：主令牌是由 Windows 内核创建并分配给进程的默认访问令牌，每一个进程有一个主令牌，它描述了与当前进程相关的用户账户的安全上下文
- 模拟令牌：一个线程可以模拟一个客户端账户，允许此线程与安全对象交互时用客户端的安全上下文

### 模拟令牌提升权限

1. 建立会话
2. 提升权限
      1. `use incognito` 加载 incognito
      2. `list_tokens` 列举用户令牌
      3. `impersonate_token V2003\\zbj` 模拟用户令牌

### 社会工程工具包

让攻击者能够利用人们自身的弱点，比如好奇心、信任、贪婪等，通过骗术来攻击受害者

使用 SET 可以向目标系统上传攻击载荷、收集目标系统的信息、创建后门、发起中间人攻击等

## Web 安全
### 常见 Web 漏洞

- 注入漏洞：当不可信的数据作为命令或查询语句的一部分被发送给解释器的时候，会发生注入漏洞，包括 SQL、NoSQL、OS 以及 LDAP 注入等
- XSS：如果应用程序在未经适当验证或转义的情况下，能够在新网页中包含不受信任的数据，或是使用可以创建 HTML 或者 JavaScript 的浏览器 API 更新包含用户提供的数据的现有网页，就会出现 XSS 漏洞

### Burp Suite 爆破密码

1. 启动，创建项目
2. 监听代理
3. 浏览器设置代理
4. 抓包，拦截
5. 发送到 Intruder
6. 添加变量
7. 选择字典
8. 攻击

## 无线安全
### 无线接入方式

- 数字蜂窝接入：数字蜂窝接入的特点是**低速率、终端处理能力弱、存储空间小等**，但该接入方式具备既有的无线链路以及移动性管理、越区切换等通信机制
- 无线局域网接入（WLAN）：多采用扩频传输技术，移动设备在链路层可通过 IEEE 802.11 标准协议或 HiperLAN 协议接入 Internet

### WALN 体系结构

- 基础结构网络（Infrastructure 网络）：带基站（即无线接入点）的无线网络。连接到有线网络的无线路由器可以作为无线接入点，实现 **有线信号** 与 **无线信号** 之间的转换，完成有线网络与无线网络的对接
- 自组织网络（Ad Hoc 网络）：没有有线基础设施支持，省去了无线中介设备 AP 的移动网络，网络中每个节点都是移动的，并且都能以任意方式动态地保持与其他节点的联系

### 无线局域网安全威胁

- WarDriving 入侵：也称为接入点映射或驾驶攻击，是一种在驾车围绕企业或住所邻里时扫描无线网络名称的活动
- WEP 破解：非法 AP 是未经网络管理人员同意或授权的、非法搭建的无线接入点
    - 一是利用专用软件将计算机伪装成 AP，实施中间人攻击，对授权客户端和 AP 进行双重欺骗
    - 二是利用真实的 AP，非法放置在被入侵的网络中
- 非法 AP
    - 占用正常信道，干扰正常的无线通信
    - 截获无线网络通信信号，入侵个人计算机，造成个人信息的泄露
    - 如果是在企事业单位内部网络上搭建非法 AP，则会严重威胁内网安全

### Airodump-ng

1. `airmon-ng` 查看无线网络接口
2. `ifconfig wlan0 down` 停用网卡，修改 MAC `macchanger --mac 00:01:02:03:04:05 wlan0`
3. `airmon-ng start wlan0` 启用网卡
4. `airodump-ng wlan0` 扫描网络
5. `airodump-ng -c 6 -w zbjAPattack --bssid 02:1A: 11:FE:EA:E6 wlan0` 监听握手包
6. `aireplay-ng --deauth 1 -a 02:1A:11:FE:EA:E6 -c 28:16:AD:41:73:F0 wlan0` 攻击
7. `aircrack-ng -w /home/weakPasswdDic.txt zbjAPattack-01.cap` 破解密码
